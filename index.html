<!-- Cambios en el formulario de "Agregar Pronóstico" -->
<label id="sofascore-label">SofaScore ID (para datos en vivo):</label>
<input type="text" id="sofascoreId" placeholder="Ej: 1234567 (de la URL de SofaScore)">

<!-- Cambios en el formulario "Editar Pronóstico" -->
<label id="new-sofascore-label">Nuevo SofaScore ID (opcional):</label>
<input type="text" id="newSofascoreId" placeholder="Ej: 1234567 (de la URL de SofaScore)">

<!-- Script actualizado -->
<script>
    const regular = [];
    const risky = [];
    const USER = 'admin';
    const PASS = 'seat9563123';

    // Traducciones actualizadas (solo las relevantes)
    const translations = {
        es: {
            // ... otras traducciones ...
            'sofascore-label': 'SofaScore ID (para datos en vivo):',
            'sofascore-placeholder': 'Ej: 1234567 (de la URL de SofaScore)',
            'new-sofascore-label': 'Nuevo SofaScore ID (opcional):',
            'new-sofascore-placeholder': 'Ej: 1234567 (de la URL de SofaScore)',
        },
        en: {
            // ... otras traducciones ...
            'sofascore-label': 'SofaScore ID (for live data):',
            'sofascore-placeholder': 'e.g., 1234567 (from SofaScore URL)',
            'new-sofascore-label': 'New SofaScore ID (optional):',
            'new-sofascore-placeholder': 'e.g., 1234567 (from SofaScore URL)',
        }
    };

    // ... resto de funciones (changeLanguage, loadData, saveData, renderVignettes) ...

    function createVignette(pred) {
        const lang = document.getElementById('language').value;
        const div = document.createElement('div');
        div.className = 'vignette';
        if (pred && pred.status) div.classList.add(pred.status);
        if (pred) {
            const score = pred.score || '0-0';
            const possession = pred.possession || '50-50';
            const [homePoss, awayPoss] = possession.split('-').map(Number);
            div.innerHTML = `
                <p>${pred.slot}</p>
                <div class="logos">
                    <img class="logo" src="${pred.logo1}" alt="Logo 1">
                    <span> vs </span>
                    <img class="logo" src="${pred.logo2}" alt="Logo 2">
                </div>
                <p>${pred.team1} vs ${pred.team2}</p>
                <p>${lang === 'es' ? 'Pronóstico: ' : 'Prediction: '} ${pred.bet}</p>
                <p>${lang === 'es' ? 'Fecha: ' : 'Date: '} ${pred.date}</p>
                <p class="score" id="score-${pred.slot}">${pred.team1} ${score} ${pred.team2}</p>
                <div class="possession-bar" id="possession-${pred.slot}" style="background: linear-gradient(to right, blue ${homePoss}%, red ${awayPoss}%);" title="${lang === 'es' ? 'Posesión' : 'Possession'}: ${pred.team1} ${homePoss}% - ${pred.team2} ${awayPoss}%"></div>
            `;
        } else {
            div.innerHTML = `<p>${lang === 'es' ? 'Pronóstico vacío' : 'Empty prediction'}</p>`;
        }
        return div;
    }

    async function updateLiveData() {
        const lang = document.getElementById('language').value;
        const allPreds = [...regular, ...risky];
        for (const pred of allPreds) {
            if (pred.sofascoreId) {
                try {
                    console.log('Solicitando datos para SofaScore ID:', pred.sofascoreId);
                    const response = await fetch(`https://api.allorigins.win/raw?url=https://www.sofascore.com/api/v1/event/${pred.sofascoreId}`);
                    if (!response.ok) {
                        console.error(`Error en SofaScore para ID ${pred.sofascoreId}: ${response.status} ${response.statusText}`);
                        continue;
                    }
                    const data = await response.json();
                    const homeGoals = data.event.homeScore.current || 0;
                    const awayGoals = data.event.awayScore.current || 0;
                    pred.score = `${homeGoals}-${awayGoals}`;
                    const homePoss = data.event.homeTeamStatistics?.possession || 50;
                    const awayPoss = 100 - homePoss;
                    pred.possession = `${homePoss}-${awayPoss}`;
                    document.getElementById(`score-${pred.slot}`).textContent = `${pred.team1} ${homeGoals} - ${awayGoals} ${pred.team2}`;
                    console.log('Marcador actualizado:', `${pred.team1} ${homeGoals} - ${awayGoals} ${pred.team2}`);
                    const bar = document.getElementById(`possession-${pred.slot}`);
                    bar.style.background = `linear-gradient(to right, blue ${homePoss}%, red ${awayPoss}%)`;
                    bar.title = `${lang === 'es' ? 'Posesión' : 'Possession'}: ${pred.team1} ${homePoss}% - ${pred.team2} ${awayPoss}%`;
                    console.log('Posesión actualizada:', `${pred.team1} ${homePoss}% - ${pred.team2} ${awayPoss}%`);
                    saveData();
                } catch (error) {
                    console.error(`Error actualizando datos para ID ${pred.sofascoreId}:`, error.message);
                }
            }
        }
    }

    function addTestPronostico() {
        const lang = document.getElementById('language').value;
        const section = document.getElementById('section').value;
        const slot = lang === 'es' ? 'Prueba Manchester United vs Fulham' : 'Test Manchester United vs Fulham';
        const team1 = 'Manchester United';
        const team2 = 'Fulham';
        const bet = lang === 'es' ? 'Gana Manchester United' : 'Manchester United Wins';
        const sofascoreId = '1234567'; // Cambia por un ID válido de SofaScore
        const score = '1-0';
        const possession = '55-45';
        const date = '2024-08-16';
        const placeholderLogo = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==';
        const pred = { slot, team1, team2, logo1: placeholderLogo, logo2: placeholderLogo, bet, sofascoreId, score, possession, date, status: 'none' };
        if (section === 'regular') regular.push(pred);
        else risky.push(pred);
        saveData();
        renderVignettes();
        alert(translations[lang]['success-test']);
    }

    document.getElementById('addForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const lang = document.getElementById('language').value;
        const section = document.getElementById('section').value;
        const slot = document.getElementById('slot').value.trim();
        const team1 = document.getElementById('team1').value.trim();
        const team2 = document.getElementById('team2').value.trim();
        const bet = document.getElementById('bet').value.trim();
        const sofascoreId = document.getElementById('sofascoreId').value.trim();
        const score = document.getElementById('score').value.trim() || '0-0';
        const possession = document.getElementById('possession').value.trim() || '50-50';
        const date = document.getElementById('date').value;
        const logo1File = document.getElementById('logo1').files[0];
        const logo2File = document.getElementById('logo2').files[0];

        if (!slot || !team1 || !team2 || !bet || !date) {
            alert(translations[lang]['error-fields']);
            return;
        }
        if (!logo1File || !logo2File) {
            alert(translations[lang]['error-images']);
            return;
        }
        try {
            const logo1 = await fileToBase64(logo1File);
            const logo2 = await fileToBase64(logo2File);
            const pred = { slot, team1, team2, logo1, logo2, bet, sofascoreId, score, possession, date, status: 'none' };
            if (section === 'regular') regular.push(pred);
            else risky.push(pred);
            saveData();
            renderVignettes();
            e.target.reset();
            alert(translations[lang]['success-add']);
        } catch (error) {
            alert(translations[lang]['error-image-process'] + error.message);
        }
    });

    document.getElementById('editForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const lang = document.getElementById('language').value;
        const section = document.getElementById('editSection').value;
        const slot = document.getElementById('editSlot').value.trim();
        const newSlot = document.getElementById('newSlot').value.trim();
        const newTeam1 = document.getElementById('newTeam1').value.trim();
        const newTeam2 = document.getElementById('newTeam2').value.trim();
        const newBet = document.getElementById('newBet').value.trim();
        const newSofascoreId = document.getElementById('newSofascoreId').value.trim();
        const newScore = document.getElementById('newScore').value.trim();
        const newPossession = document.getElementById('newPossession').value.trim();
        const newDate = document.getElementById('newDate').value;
        const newLogo1File = document.getElementById('newLogo1').files[0];
        const newLogo2File = document.getElementById('newLogo2').files[0];

        const arr = section === 'regular' ? regular : risky;
        const pred = arr.find(p => p.slot === slot);
        if (pred) {
            if (newSlot) pred.slot = newSlot;
            if (newTeam1) pred.team1 = newTeam1;
            if (newTeam2) pred.team2 = newTeam2;
            if (newBet) pred.bet = newBet;
            if (newSofascoreId) pred.sofascoreId = newSofascoreId;
            if (newScore) pred.score = newScore;
            if (newPossession) pred.possession = newPossession;
            if (newDate) pred.date = newDate;
            if (newLogo1File) pred.logo1 = await fileToBase64(newLogo1File);
            if (newLogo2File) pred.logo2 = await fileToBase64(newLogo2File);
            saveData();
            renderVignettes();
            e.target.reset();
            alert(translations[lang]['success-edit']);
        } else {
            alert(translations[lang]['error-not-found']);
        }
    });

    // ... resto de funciones (updateForm, deleteForm, logout, etc.) ...

    loadData();
    setInterval(updateLiveData, 30000); // Actualizar cada 30 segundos
</script>